import{r,j as e,B as C,e as S,E,c as M,p as D,X as R,q as L,d as T,L as N,s as $,h as q,Z as B}from"./vendor-paJ_2uBt.js";import{c as H,s as K}from"./AiAdvisor-jO6VyZ6t.js";const G=({onOpenFull:h})=>{const[u,m]=r.useState(!1),[n,y]=r.useState(!1),[l,d]=r.useState([{role:"model",text:"Hello! I am your EnvirosAgro AI Assistant. How can I help you advance your sustainable farming goals today?",timestamp:new Date}]),[g,w]=r.useState(""),[a,j]=r.useState(!1),c=r.useRef(null),x=r.useRef(null);r.useEffect(()=>{u&&!c.current&&(c.current=H())},[u]),r.useEffect(()=>{x.current&&(x.current.scrollTop=x.current.scrollHeight)},[l]);const p=async t=>{const s=t||g;if(!s.trim()||!c.current||a)return;const A={role:"user",text:s,timestamp:new Date};d(o=>[...o,A]),w(""),j(!0);try{const o={role:"model",text:"",timestamp:new Date};d(f=>[...f,o]);const b=await K(c.current,s);let v="";for await(const f of b){const k=f.text();k&&(v+=k,d(I=>{const i=[...I];return i[i.length-1]={...i[i.length-1],text:v},i}))}}catch(o){console.error("Consultant Error:",o),d(b=>[...b,{role:"model",text:"I encountered a synchronization error. Please try again in a moment.",timestamp:new Date}])}finally{j(!1)}},z=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),p())};return u?e.jsx("div",{className:`fixed bottom-6 right-6 z-[60] flex flex-col transition-all duration-500 ease-out ${n?"h-16 w-64":"h-[600px] w-[400px] max-w-[90vw] max-h-[80vh]"}`,children:e.jsxs("div",{className:"bg-white dark:bg-earth-900 flex flex-col h-full rounded-[2rem] shadow-2xl border border-earth-100 dark:border-earth-800 overflow-hidden",children:[e.jsxs("div",{className:"bg-agro-950 text-white p-5 flex items-center justify-between shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-agro-500 p-2 rounded-xl",children:e.jsx(S,{size:18,fill:"white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-sm leading-tight",children:"AI Assistant"}),e.jsx("p",{className:"text-[10px] text-agro-400 font-bold uppercase tracking-widest",children:"Sustainability Expert"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>{m(!1),h==null||h()},className:"p-2 hover:bg-white/10 rounded-lg transition-colors",title:"Open Full Interface",children:e.jsx(E,{size:16})}),e.jsx("button",{onClick:()=>y(!n),className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:n?e.jsx(M,{size:16}):e.jsx(D,{size:16})}),e.jsx("button",{onClick:()=>m(!1),className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:e.jsx(R,{size:20})})]})]}),!n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:x,className:"flex-1 overflow-y-auto p-6 space-y-6 custom-scrollbar bg-earth-50/30 dark:bg-earth-950/20",children:[l.map((t,s)=>e.jsx("div",{className:`flex ${t.role==="user"?"justify-end":"justify-start"} animate-in fade-in slide-in-from-bottom-2 duration-300`,children:e.jsxs("div",{className:`max-w-[85%] flex gap-3 ${t.role==="user"?"flex-row-reverse":"flex-row"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center shrink-0 shadow-sm border ${t.role==="user"?"bg-white text-earth-400 border-earth-200":"bg-agro-600 text-white border-agro-500"}`,children:t.role==="user"?e.jsx(L,{size:14}):e.jsx(T,{size:14})}),e.jsx("div",{className:`p-4 rounded-2xl text-sm leading-relaxed ${t.role==="user"?"bg-agro-900 text-white rounded-tr-none":"bg-white dark:bg-earth-800 text-earth-800 dark:text-earth-100 shadow-sm border border-earth-100 dark:border-earth-700 rounded-tl-none"}`,children:t.text||(a&&s===l.length-1?e.jsx(N,{size:18,className:"animate-spin text-agro-600"}):"")})]})},s)),l.length<3&&!a&&e.jsxs("div",{className:"grid gap-2 pt-4",children:[e.jsx("p",{className:"text-[10px] font-black text-earth-400 uppercase tracking-widest px-2",children:"Assistant Topics"}),["My soil resilience score","Sustainable irrigation","IA Thrust overview"].map((t,s)=>e.jsxs("button",{onClick:()=>p(t),className:"text-left p-3 bg-white dark:bg-earth-800 hover:bg-agro-50 dark:hover:bg-agro-900/40 border border-earth-100 dark:border-earth-700 rounded-xl text-xs font-medium text-earth-600 dark:text-earth-400 transition-all flex items-center justify-between group",children:[t,e.jsx($,{size:12,className:"opacity-0 group-hover:opacity-100 -translate-x-2 group-hover:translate-x-0 transition-all"})]},s))]})]}),e.jsxs("div",{className:"p-4 bg-white dark:bg-earth-900 border-t border-earth-100 dark:border-earth-800",children:[e.jsxs("div",{className:"relative flex items-center bg-earth-50 dark:bg-earth-800 rounded-2xl border border-earth-200 dark:border-earth-700 focus-within:ring-2 focus-within:ring-agro-500/20 transition-all",children:[e.jsx("input",{type:"text",value:g,onChange:t=>w(t.target.value),onKeyDown:z,placeholder:"Ask a question...",className:"w-full bg-transparent p-4 text-sm focus:outline-none dark:text-white"}),e.jsx("button",{onClick:()=>p(),disabled:a||!g.trim(),className:"p-2 mr-2 bg-agro-600 text-white rounded-xl hover:bg-agro-700 disabled:opacity-50 transition-colors shadow-lg",children:a?e.jsx(N,{size:20,className:"animate-spin"}):e.jsx(q,{size:20})})]}),e.jsx("div",{className:"mt-3 flex items-center justify-center gap-4",children:e.jsxs("p",{className:"text-[9px] text-earth-400 font-bold uppercase tracking-wider flex items-center gap-1",children:[e.jsx(B,{size:10,fill:"currentColor",className:"text-amber-500"})," EnvirosAgro Trusted Intelligence"]})})]})]})]})}):e.jsxs("button",{onClick:()=>m(!0),className:"fixed bottom-6 right-6 z-[60] bg-agro-900 text-white p-4 rounded-full shadow-2xl hover:scale-110 active:scale-95 transition-all group border-4 border-white dark:border-earth-800",children:[e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-white animate-pulse"}),e.jsx(C,{size:28,className:"group-hover:rotate-12 transition-transform"}),e.jsx("span",{className:"absolute right-full mr-4 bg-white text-agro-900 px-4 py-2 rounded-xl text-xs font-bold shadow-xl opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none border border-earth-100",children:"AI Assistant Online"})]})};export{G as AiConsultantFloating};
