import{r,j as e}from"../vendor-react-395Lia7H.js";import"../vendor-firebase-329p0KzR.js";import{g as C,a as P,i as S,b as z,c as I,d as L,r as A,u as R,e as U,f as D,h as E,s as F}from"../vendor-@firebase-M2Arj_tU.js";import{L as p,X as T,a6 as $,a7 as B,a8 as q}from"../vendor-lucide-react-Cxzx__9e.js";const G={apiKey:"AIzaSyBNVYoqxPepnbRRtC68BRTxgqFp1FVO3xI",authDomain:"envirosagro-git-93534258-78537.firebaseapp.com",projectId:"envirosagro-git-93534258-78537",storageBucket:"envirosagro-git-93534258-78537.firebasestorage.app",messagingSenderId:"399076515746",appId:"1:399076515746:web:f947e5e4dd216826b81cfb",measurementId:"G-1MNDXE8PG5"},d=S(G);typeof window<"u"?z().then(t=>t?I(d):null):Promise.resolve(null);L(d);const V=P(d),W=C(d),Y=({user:t,onClose:h,onPostCreated:f})=>{const[c,b]=r.useState(""),[o,j]=r.useState(null),[n,i]=r.useState("text"),[u,k]=r.useState(""),[x,g]=r.useState(!1),[m,l]=r.useState(null),v=a=>{if(a.target.files&&a.target.files[0]){const s=a.target.files[0];j(s),s.type.startsWith("image/")?i("image"):i("text")}},w=async a=>{if(a.preventDefault(),!t){l("User not found. Please log in again.");return}if(!c.trim()){l("Post content cannot be empty.");return}g(!0),l(null);try{let s="";if(o){const y=A(W,`posts/${t.email}/${Date.now()}_${o.name}`),N=await R(y,o);s=await U(N.ref)}await D(E(V,"posts"),{authorName:t.name,authorEmail:t.email,authorAvatar:t.avatar||null,text:c,type:n,attachmentUrl:s,linkUrl:n==="link"?u:"",timestamp:F(),likes:0,comments:[]}),f(),h()}catch(s){l("Failed to create post. Please try again."),console.error(s)}finally{g(!1)}};return t?e.jsxs("div",{className:"bg-white dark:bg-earth-900 rounded-3xl shadow-2xl w-full max-w-2xl p-8 relative",children:[e.jsx("button",{onClick:h,className:"absolute top-6 right-6 text-earth-400 hover:text-red-500 transition-colors",children:e.jsx(T,{size:24})}),e.jsx("h2",{className:"text-2xl font-bold text-agro-900 dark:text-white mb-6",children:"Create a New Post"}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsx("textarea",{value:c,onChange:a=>b(a.target.value),placeholder:`What's on your mind, ${t.name}?`,className:"w-full h-32 bg-earth-50 dark:bg-earth-800 rounded-xl p-4 focus:outline-none focus:ring-2 focus:ring-agro-500 dark:text-white transition",required:!0}),n==="link"&&e.jsx("input",{type:"url",value:u,onChange:a=>k(a.target.value),placeholder:"Enter URL...",className:"w-full bg-earth-100 dark:bg-earth-800 rounded-xl p-3 px-4 focus:outline-none focus:ring-2 focus:ring-agro-500 dark:text-white"}),o&&e.jsxs("div",{className:"text-sm text-earth-500 dark:text-earth-400",children:["Attached: ",o.name]}),m&&e.jsx("p",{className:"text-red-500 text-sm",children:m}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer p-3 rounded-full hover:bg-earth-100 dark:hover:bg-earth-800 text-earth-500 dark:text-earth-400 transition-colors",children:[e.jsx($,{size:20}),e.jsx("input",{id:"file-upload",type:"file",className:"hidden",onChange:v})]}),e.jsx("button",{type:"button",onClick:()=>i("image"),className:`p-3 rounded-full hover:bg-earth-100 dark:hover:bg-earth-800 ${n==="image"?"text-agro-600":"text-earth-500 dark:text-earth-400"}`,children:e.jsx(B,{size:20})}),e.jsx("button",{type:"button",onClick:()=>i("link"),className:`p-3 rounded-full hover:bg-earth-100 dark:hover:bg-earth-800 ${n==="link"?"text-agro-600":"text-earth-500 dark:text-earth-400"}`,children:e.jsx(q,{size:20})})]}),e.jsx("button",{type:"submit",disabled:x,className:"bg-agro-600 hover:bg-agro-700 text-white font-bold py-3 px-8 rounded-full shadow-lg flex items-center justify-center gap-2 transition-all disabled:bg-earth-300",children:x?e.jsx(p,{className:"animate-spin",size:20}):"Post"})]})]})]}):e.jsx("div",{className:"bg-white dark:bg-earth-900 rounded-3xl shadow-2xl w-full max-w-2xl p-8 relative flex items-center justify-center h-96",children:e.jsx(p,{className:"animate-spin text-agro-500",size:48})})};export{Y as C,V as d};
